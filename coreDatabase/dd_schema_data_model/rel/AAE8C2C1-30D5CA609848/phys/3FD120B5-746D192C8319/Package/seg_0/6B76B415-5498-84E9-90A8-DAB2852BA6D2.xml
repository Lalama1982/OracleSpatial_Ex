<?xml version = '1.0' encoding = 'UTF-8'?>
<PackageOracle class="oracle.dbtools.crest.model.design.storage.oracle.PackageOracle" name="DD_SEARCH_PKG" directorySegmentName="seg_0" id="6B76B415-5498-84E9-90A8-DAB2852BA6D2">
<sourceConnName>dd</sourceConnName>
<sourceObjSchema>DD</sourceObjSchema>
<sourceObjName>DD_SEARCH_PKG</sourceObjName>
<createdBy>bcarter</createdBy>
<createdTime>2015-07-15 22:15:20 UTC</createdTime>
<ownerDesignName>dd_schema_data_model</ownerDesignName>
<owner>29F77958-DE9B-AAEB-4F89-771962185EA5</owner>
<source>CREATE OR REPLACE PACKAGE DD.DD_SEARCH_PKG&lt;br/&gt;AS&lt;br/&gt;  TYPE member_id_array_type IS TABLE OF INTEGER&lt;br/&gt;  INDEX BY PLS_INTEGER;&lt;br/&gt;&lt;br/&gt;  TYPE dino_name_array_type IS TABLE OF VARCHAR2 (500)&lt;br/&gt;  INDEX BY PLS_INTEGER;&lt;br/&gt;&lt;br/&gt;  PROCEDURE text_only (member_id_p       IN     INTEGER,&lt;br/&gt;                       search_string     IN     VARCHAR2,&lt;br/&gt;                       member_id_array      OUT member_id_array_type,&lt;br/&gt;                       dino_name_array      OUT dino_name_array_type,&lt;br/&gt;                       num_dinos         IN     INTEGER);&lt;br/&gt;&lt;br/&gt;  PROCEDURE text_and_spatial (member_id_p       IN     INTEGER,&lt;br/&gt;                              search_string     IN     VARCHAR2,&lt;br/&gt;                              max_distance      IN     INTEGER,&lt;br/&gt;                              member_id_array      OUT member_id_array_type,&lt;br/&gt;                              dino_name_array      OUT dino_name_array_type,&lt;br/&gt;                              num_dinos         IN     INTEGER);&lt;br/&gt;END dd_search_pkg;</source>
<body class="oracle.dbtools.crest.model.design.storage.oracle.PackageBodyOracle" name="DD_SEARCH_PKG" id="6B76B415-5498-84E9-90A8-DAB2852BA6D2">
<sourceConnName>dd</sourceConnName>
<sourceObjSchema>DD</sourceObjSchema>
<sourceObjName>DD_SEARCH_PKG</sourceObjName>
<createdBy>bcarter</createdBy>
<createdTime>2015-07-15 22:15:21 UTC</createdTime>
<ownerDesignName>dd_schema_data_model</ownerDesignName>
<owner>29F77958-DE9B-AAEB-4F89-771962185EA5</owner>
<source>CREATE OR REPLACE PACKAGE BODY DD.DD_SEARCH_PKG&lt;br/&gt;AS&lt;br/&gt;&lt;br/&gt;  /*&lt;br/&gt;   * Search for dates using Oracle Text&lt;br/&gt;   */&lt;br/&gt;  PROCEDURE text_only (member_id_p       IN     INTEGER,&lt;br/&gt;                       search_string     IN     VARCHAR2,&lt;br/&gt;                       member_id_array      OUT member_id_array_type,&lt;br/&gt;                       dino_name_array      OUT dino_name_array_type,&lt;br/&gt;                       num_dinos         IN     INTEGER)&lt;br/&gt;  IS&lt;br/&gt;    BEGIN&lt;br/&gt;      SELECT member_id, dino_name&lt;br/&gt;      BULK COLLECT INTO member_id_array, dino_name_array&lt;br/&gt;      FROM dd_members&lt;br/&gt;      WHERE contains (about_yourself, search_string) &gt; 0&lt;br/&gt;            AND member_id != member_id_p&lt;br/&gt;      OFFSET 0 ROWS FETCH NEXT num_dinos ROWS ONLY;&lt;br/&gt;    END;&lt;br/&gt;&lt;br/&gt;  /*&lt;br/&gt;   * Search for dates using Oracle Text and Oracle Spatial&lt;br/&gt;   */&lt;br/&gt;  PROCEDURE text_and_spatial (member_id_p       IN     INTEGER,&lt;br/&gt;                              search_string     IN     VARCHAR2,&lt;br/&gt;                              max_distance      IN     INTEGER,&lt;br/&gt;                              member_id_array      OUT member_id_array_type,&lt;br/&gt;                              dino_name_array      OUT dino_name_array_type,&lt;br/&gt;                              num_dinos         IN     INTEGER)&lt;br/&gt;  IS&lt;br/&gt;    BEGIN&lt;br/&gt;      SELECT dm.member_id, dm.dino_name&lt;br/&gt;      BULK COLLECT INTO member_id_array, dino_name_array&lt;br/&gt;      FROM dd_members dm,&lt;br/&gt;        dd_locations dl,&lt;br/&gt;        (SELECT geometry&lt;br/&gt;         FROM dd_members this_m, dd_locations this_l&lt;br/&gt;         WHERE     this_m.location_id = this_l.location_id&lt;br/&gt;                   AND this_m.member_id = text_and_spatial.member_id_p)&lt;br/&gt;        member_location&lt;br/&gt;      WHERE dm.location_id = dl.location_id&lt;br/&gt;            AND contains (about_yourself, search_string) &gt; 0&lt;br/&gt;            AND sdo_within_distance (&lt;br/&gt;                    dl.geometry,&lt;br/&gt;                    member_location.geometry,&lt;br/&gt;                    &apos;distance=&apos; || max_distance || &apos; unit=km&apos;) = &apos;TRUE&apos;&lt;br/&gt;            AND dm.member_id != text_and_spatial.member_id_p&lt;br/&gt;      OFFSET 0 ROWS FETCH NEXT num_dinos ROWS ONLY;&lt;br/&gt;    END;&lt;br/&gt;END dd_search_pkg;</source>
</body>
</PackageOracle>