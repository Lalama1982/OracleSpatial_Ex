<?xml version = '1.0' encoding = 'UTF-8'?>
<PackageOracle class="oracle.dbtools.crest.model.design.storage.oracle.PackageOracle" name="DD_ADMIN_PKG" directorySegmentName="seg_0" id="D01709F3-ECA2-784E-520D-587CE9812306">
<sourceConnName>dd</sourceConnName>
<sourceObjSchema>DD</sourceObjSchema>
<sourceObjName>DD_ADMIN_PKG</sourceObjName>
<createdBy>bcarter</createdBy>
<createdTime>2015-07-15 22:15:18 UTC</createdTime>
<ownerDesignName>dd_schema_data_model</ownerDesignName>
<owner>29F77958-DE9B-AAEB-4F89-771962185EA5</owner>
<source>CREATE OR REPLACE PACKAGE DD.DD_ADMIN_PKG&lt;br/&gt;AS&lt;br/&gt;  c_admin_id   CONSTANT INTEGER := 0;&lt;br/&gt;&lt;br/&gt;  /* Send a message to one user; the caller should commit; */&lt;br/&gt;  PROCEDURE send_message (from_member_id_p     IN INTEGER,&lt;br/&gt;                          to_member_id_p       IN INTEGER,&lt;br/&gt;                          subject_p            IN VARCHAR2,&lt;br/&gt;                          message_contents_p   IN VARCHAR2);&lt;br/&gt;&lt;br/&gt;  /* Send a message to all users; the caller should commit; */&lt;br/&gt;  PROCEDURE broadcast_message (from_member_id_p   IN INTEGER,&lt;br/&gt;                               subject_p          IN VARCHAR2,&lt;br/&gt;                               message_in         IN VARCHAR2);&lt;br/&gt;END;</source>
<body class="oracle.dbtools.crest.model.design.storage.oracle.PackageBodyOracle" name="DD_ADMIN_PKG" id="D01709F3-ECA2-784E-520D-587CE9812306">
<sourceConnName>dd</sourceConnName>
<sourceObjSchema>DD</sourceObjSchema>
<sourceObjName>DD_ADMIN_PKG</sourceObjName>
<createdBy>bcarter</createdBy>
<createdTime>2015-07-15 22:15:18 UTC</createdTime>
<ownerDesignName>dd_schema_data_model</ownerDesignName>
<owner>29F77958-DE9B-AAEB-4F89-771962185EA5</owner>
<source>CREATE OR REPLACE PACKAGE BODY DD.DD_ADMIN_PKG&lt;br/&gt;AS&lt;br/&gt;  /*&lt;br/&gt;   * Send send one mail message to a member&lt;br/&gt;   */&lt;br/&gt;  PROCEDURE send_message (from_member_id_p     IN INTEGER,&lt;br/&gt;                          to_member_id_p       IN INTEGER,&lt;br/&gt;                          subject_p            IN VARCHAR2,&lt;br/&gt;                          message_contents_p   IN VARCHAR2)&lt;br/&gt;  AS&lt;br/&gt;    BEGIN&lt;br/&gt;      INSERT INTO dd_messages (from_member_id,&lt;br/&gt;                               to_member_id,&lt;br/&gt;                               subject,&lt;br/&gt;                               message_contents)&lt;br/&gt;      VALUES (from_member_id_p,&lt;br/&gt;              to_member_id_p,&lt;br/&gt;              subject_p,&lt;br/&gt;              message_contents_p);&lt;br/&gt;    END;&lt;br/&gt;&lt;br/&gt;  /*&lt;br/&gt;   * Send a broadcast message to all members&lt;br/&gt;   */&lt;br/&gt;  PROCEDURE broadcast_message (from_member_id_p   IN INTEGER,&lt;br/&gt;                               subject_p          IN VARCHAR2,&lt;br/&gt;                               message_in         IN VARCHAR2)&lt;br/&gt;  IS&lt;br/&gt;    TYPE members_t IS TABLE OF dd_members%ROWTYPE;&lt;br/&gt;&lt;br/&gt;    l_members   members_t;&lt;br/&gt;    BEGIN&lt;br/&gt;      SELECT *&lt;br/&gt;      BULK COLLECT INTO l_members&lt;br/&gt;      FROM dd_members;&lt;br/&gt;&lt;br/&gt;      FORALL indx IN 1 .. l_members.COUNT&lt;br/&gt;      INSERT INTO dd_messages (from_member_id,&lt;br/&gt;                               to_member_id,&lt;br/&gt;                               subject,&lt;br/&gt;                               message_contents)&lt;br/&gt;      VALUES (from_member_id_p,&lt;br/&gt;              l_members (indx).member_id,&lt;br/&gt;              subject_p,&lt;br/&gt;              message_in);&lt;br/&gt;      COMMIT;&lt;br/&gt;    END;&lt;br/&gt;&lt;br/&gt;  /* Alternative broadcase implemenation using the LIMIT feature to&lt;br/&gt;   * avoid possible session memory errors - when DinoDate is INCREDIBLY&lt;br/&gt;   * successful. Also add exception handling to ensure that as many&lt;br/&gt;   * messages go out as possible.&lt;br/&gt;   */&lt;br/&gt;  PROCEDURE broadcast_message_big (&lt;br/&gt;    from_member_id_p   IN INTEGER,&lt;br/&gt;    subject_p          IN VARCHAR2,&lt;br/&gt;    message_in         IN VARCHAR2,&lt;br/&gt;    fetch_limit_in     IN INTEGER DEFAULT 100)&lt;br/&gt;  IS&lt;br/&gt;      failure_in_forall   EXCEPTION;&lt;br/&gt;  PRAGMA EXCEPTION_INIT (failure_in_forall, -24381);&lt;br/&gt;&lt;br/&gt;    TYPE members_t IS TABLE OF dd_members%ROWTYPE;&lt;br/&gt;&lt;br/&gt;    l_members           members_t;&lt;br/&gt;&lt;br/&gt;    CURSOR members_cur&lt;br/&gt;    IS&lt;br/&gt;      SELECT * FROM dd_members;&lt;br/&gt;    BEGIN&lt;br/&gt;      OPEN members_cur;&lt;br/&gt;&lt;br/&gt;      LOOP&lt;br/&gt;        FETCH members_cur&lt;br/&gt;        BULK COLLECT INTO l_members&lt;br/&gt;        LIMIT fetch_limit_in;&lt;br/&gt;&lt;br/&gt;        BEGIN&lt;br/&gt;          FORALL indx IN 1 .. l_members.COUNT SAVE EXCEPTIONS&lt;br/&gt;          INSERT INTO dd_messages (from_member_id,&lt;br/&gt;                                   to_member_id,&lt;br/&gt;                                   subject,&lt;br/&gt;                                   message_contents)&lt;br/&gt;          VALUES (from_member_id_p,&lt;br/&gt;                  l_members (indx).member_id,&lt;br/&gt;                  subject_p,&lt;br/&gt;                  message_in);&lt;br/&gt;          EXCEPTION&lt;br/&gt;          WHEN failure_in_forall&lt;br/&gt;          THEN&lt;br/&gt;          FOR indx IN 1 .. SQL%BULK_EXCEPTIONS.COUNT&lt;br/&gt;          LOOP&lt;br/&gt;            DBMS_OUTPUT.put_line (&lt;br/&gt;                &apos;Error &apos;&lt;br/&gt;                || indx&lt;br/&gt;                || &apos; occurred on index &apos;&lt;br/&gt;                || SQL%BULK_EXCEPTIONS (indx).ERROR_INDEX&lt;br/&gt;                || &apos; with error &apos;&lt;br/&gt;                || SQLERRM (&lt;br/&gt;                    -1&lt;br/&gt;                    * SQL%BULK_EXCEPTIONS (indx).ERROR_CODE));&lt;br/&gt;          END LOOP;&lt;br/&gt;        END;&lt;br/&gt;      END LOOP;&lt;br/&gt;      COMMIT;&lt;br/&gt;    END;&lt;br/&gt;END;</source>
</body>
</PackageOracle>